<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body></body>
<script>
    var array = [];
    var snakeBody = [[1, 0], [1, 1], [1, 2]];
    var snakeHeadPosition = snakeBody[snakeBody.length - 1];
    var yTableSize = 23;
    var xTableSize = 23;
    var lastPushedButton = 'ArrowRight'
    var snakeSize = 30;
    var gameSpeed = 100;

    var yfoodPosition = Math.floor(Math.random() * yTableSize);
    var xfoodPosition = Math.floor(Math.random() * xTableSize);
    var foodPosition = [yfoodPosition, xfoodPosition]
    var color = 'red';

    var isFood = false;

    class Field {

        get getID() {
            return this.Id;
        }
        constructor(id, y, x) {
            this.Id = id
            var fieldSize = snakeSize;
            var field = document.createElement('canvas');
            var ctx = field.getContext("2d");
            field.id = id;
            field.style.width = fieldSize + "px";
            field.style.height = fieldSize + "px";
            ctx.fillStyle = "red";
            field.style.left = fieldSize * x + "px";
            field.style.top = fieldSize * y + "px";
            field.style.position = "absolute";
            field.style.backgroundColor = "grey"
            document.body.appendChild(field)
        }
    }
    class Table {

        DisplayTheTable() {
            var id = 0;
            for (var i = 0; i < yTableSize; i++) {
                array.push([]);
                for (var j = 0; j < xTableSize; j++) {
                    array[i].push(new Field(id, i, j))
                    id++;
                }
            }
        }
        RedrawTheTable() {
            for (var i = 0; i < yTableSize * xTableSize; i++) {
                if (i % 2 == 0) {
                    document.getElementById(i).style.backgroundColor = "DimGrey";
                }
                else {
                    document.getElementById(i).style.backgroundColor = "DarkSlateGrey";
                }
            }
        }
    }
    class Snake {

        DrawTheSnake() {
            for (var i = 0; i < snakeBody.length; i++) {
                document.getElementById(array[snakeBody[i][0]][snakeBody[i][1]].getID).style.backgroundColor = "CornflowerBlue";
            }
        }

        Eat() {
            yfoodPosition = Math.floor(Math.random() * yTableSize);
            xfoodPosition = Math.floor(Math.random() * xTableSize);
            foodPosition = [yfoodPosition, xfoodPosition]
        }
        DontGrow() {
            snakeBody.splice(0, 1)
        }
    }
    class Food {

        PlaceFood() {
            document.getElementById(array[yfoodPosition][xfoodPosition].getID).style.backgroundColor = color;
        }
    }

    class Control {
        Move(pushedButton) {
            var yDirection = 0;
            var xDirection = 0;

            if (pushedButton == 'ArrowUp') {
                if (lastPushedButton != 'ArrowDown') {
                    yDirection = -1;
                    lastPushedButton = 'ArrowUp'
                }
            }
            if (pushedButton == 'ArrowDown') {
                if (lastPushedButton != 'ArrowUp') {
                    yDirection = 1;
                    lastPushedButton = 'ArrowDown'
                }
            }
            if (pushedButton == 'ArrowLeft') {
                if (lastPushedButton != 'ArrowRight') {
                    xDirection = -1;
                    lastPushedButton = 'ArrowLeft'
                }
            }
            if (pushedButton == 'ArrowRight') {
                if (lastPushedButton != 'ArrowLeft') {
                    xDirection = 1;
                    lastPushedButton = 'ArrowRight'
                }
            }
            //add new part to snake
            snakeBody.push([]);
            snakeBody[snakeBody.length - 1].push(snakeBody[snakeBody.length - 2][0] + yDirection);
            snakeBody[snakeBody.length - 1].push(snakeBody[snakeBody.length - 2][1] + xDirection);
            snakeHeadPosition = snakeBody[snakeBody.length - 1];
            //remove the last item from the snake

            table.RedrawTheTable();
            food.PlaceFood();
            snake.DrawTheSnake();


            if (snakeHeadPosition[0] == foodPosition[0] && snakeHeadPosition[1] == foodPosition[1]) {
                snake.Eat();
            }
            else {
                snake.DontGrow();
            }
        }
    }
    class Timer {
        Sleep() {
            const timer = ms => new Promise(res => setTimeout(res, ms))
            async function load() {
                while (true) {
                    await timer(gameSpeed);
                    control.Move(lastPushedButton);

                }
            }
            load();
            document.querySelector('body').addEventListener('keydown', function (e) {
                control.Move(e.key)
                console.log(e.key)
            })
        }
    }

    class PlayerAction {

        // PauseGame() {
        //     document.querySelector('body').addEventListener('keydown', function (e) {
        //         control.Move(e.key)
        //         if (e.key == 'p') {
        //             gameSpeed = 999999999
        //         }

        //     })


        // }
        // ResumeGame() {
        //     document.querySelector('body').addEventListener('keydown', function (e) {
        //         control.Move(e.key)
        //         if (e.key == 'r') {
        //             gameSpeed = 999999999
        //         }
        //     })
        // }
    }
    class Main {

        StartTheGame() {
            table.DisplayTheTable();
            snake.DrawTheSnake();
            timer.Sleep();
        }
    }

    var snake = new Snake();
    var field = new Field();
    var table = new Table();
    var control = new Control();
    var timer = new Timer();
    var main = new Main();
    var food = new Food();
    var playerAction = new PlayerAction();

    main.StartTheGame();
    playerAction.PauseGame();
    playerAction.ResumeGame();

</script>

</html>